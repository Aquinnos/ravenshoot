var T=Object.defineProperty;var q=(i,e,t)=>e in i?T(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var S=(i,e,t)=>(q(i,typeof e!="symbol"?e+"":e,t),t);import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as H}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";import{getAuth as R}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";import{getFirestore as A,collection as Y,query as W,orderBy as O,limit as G,getDocs as X,doc as $,getDoc as P,updateDoc as K}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";const N={apiKey:"AIzaSyA7COjHY9unIuzQTpk4mKY64IpiCywM3tY",authDomain:"point-shoot-game.firebaseapp.com",projectId:"point-shoot-game",storageBucket:"point-shoot-game.appspot.com",messagingSenderId:"68603130080",appId:"1:68603130080:web:58b672347d9b3af9482085",measurementId:"G-WKSEDH9XSF"},k=H(N),C=A(k),B=R(k);document.addEventListener("DOMContentLoaded",i=>{document.getElementById("volumeSlider").addEventListener("input",function(){D.forEach(t=>{t.volume=this.value}),p.value=this.value})});document.querySelector("#app").innerHTML=`
    <div class="video-overlay fixed top-0 left-0 w-full h-full bg-black bg-opacity-40 z-10 -z-100"></div>
    <canvas id="collisionCanvas" class=" opacity-0"></canvas>
    <canvas id="canvas1"></canvas>
    <button id="resetButton" class="button w-[350px] border-white border-solid opacity-0 fixed top-[55%] left-1/2 -translate-x-1/2 -translate-y-1/2 py-3 cursor-pointer ">Reset Game</button>
    <div id="startButtons" class="w-[350px] h-[500px] flex flex-col items-center gap-1 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-20 border-white border-solid border rounded-xl text-white bg-black/20 z-10">
            <p class="w-full">Raven Shoot</p>
            <button id="startGameButton" class="button">Start</button>
            <button id="leaderboardButton" class="button">Leaderboard</button>
            <button id="quitButton" class="button">Quit</button>
            <label for="volumeSlider">Volume Control:</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.2" />
    </div>
    <div id="leaderboardContainer" class=" gap-2 hidden w-[350px] h-[500px] flex-col items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-20 border-white border-solid border rounded-xl text-white bg-black/20 z-10">
        <p>Leaderboard</p>
        <div id="scoresContainer" class=" text-white px-2 py-2 border-solid border-2 rounded-xl border-white w-52 h-72 b"></div>
        <button id="backButton" class="button my-2">Back</button>
    </div>
`;const r=document.getElementById("canvas1"),o=r.getContext("2d"),w=document.getElementById("collisionCanvas"),m=w.getContext("2d");r.width=window.innerWidth;r.height=window.innerHeight;w.width=window.innerWidth;w.height=window.innerHeight;let a=0,E=0,M=!1;o.font="50px Impact";let g=new Audio;g.src="../audio/gameOver.wav";g.volume=.2;let h=new Audio;h.src="../audio/backgroundMusic.mp3";h.volume=.2;let U=document.getElementById("leaderboardButton");document.getElementById("buttonsContainer");let F=document.getElementById("leaderboardContainer"),Q=document.getElementById("backButton"),V=document.getElementById("startGameButton"),z=document.getElementById("quitButton"),b=document.querySelector("#startButtons"),J=document.getElementById("volumeSlider"),v=0,x=500,I=0,D=[g,h];D.forEach(i=>{i.volume=J.value});let d=[],c=[],u=[];class Z{constructor(){this.spriteWidth=271,this.spriteHeight=194,this.sizeModifier=Math.random()*.6+.4,this.width=this.spriteWidth*this.sizeModifier,this.height=this.spriteHeight*this.sizeModifier,this.x=r.width,this.y=this.y=Math.random()*(r.height-this.height),this.directionX=Math.random()*5+3,this.directionY=Math.random()*5-2.5,this.markedForDeletion=!1,this.image=new Image,this.image.src="../images/raven.png",this.frame=0,this.maxFrame=4,this.timeSinceFlap=0,this.flapInterval=Math.random()*50+50,this.randomColors=[Math.random()*255,Math.random()*255,Math.random()*255],this.color="rgb("+this.randomColors[0]+","+this.randomColors[1]+","+this.randomColors[2]+")",this.hasTrail=Math.random()>.5}update(e){if((this.y<0||this.y>r.height-this.height)&&(this.directionY=this.directionY*-1),this.x-=this.directionX,this.y+=this.directionY,this.x<0-this.width&&(this.markedForDeletion=!0),this.timeSinceFlap+=e,this.timeSinceFlap>this.flapInterval&&(this.frame>this.maxFrame?this.frame=0:this.frame++,this.timeSinceFlap=0,this.hasTrail))for(let t=0;t<5;t++)u.push(new _(this.x,this.y,this.width,this.color));this.x<0-this.width&&(M=!0)}draw(){m.fillStyle=this.color,m.fillRect(this.x,this.y,this.width,this.height),o.drawImage(this.image,this.spriteWidth*this.frame,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height)}}const f=class f{constructor(e,t,s){this.image=new Image,this.image.src="../images/explosion.png",this.spriteWidth=200,this.spriteHeight=179,this.size=s,this.x=e,this.y=t,this.frame=0,this.sound=new Audio,this.sound.src="../audio/explosion.wav",this.sound.volume=f.value,this.timeSinceLastFrame=0,this.frameInterval=200,this.markedForDeletion=!1}update(e){this.frame===0&&this.sound.play(),this.timeSinceLastFrame+=e,this.timeSinceLastFrame>this.frameInterval&&(this.frame++,this.timeSinceLastFrame=0,this.frame>5&&(this.markedForDeletion=!0))}draw(){o.drawImage(this.image,this.spriteWidth*this.frame,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.size,this.size)}};S(f,"value",.1);let p=f;class _{constructor(e,t,s,l){this.size=s,this.x=e+this.size/2+Math.random()*50-25,this.y=t+this.size/3+Math.random()*50-25,this.radius=Math.random()*this.size/10,this.maxRadius=Math.random()*20+35,this.markedForDeletion=!1,this.speedX=Math.random()*1-.5,this.speedY=Math.random()*1-.5,this.color=l}update(){this.x+=this.speedX,this.y+=this.speedY,this.radius<this.maxRadius-5?this.radius+=.3:this.markedForDeletion=!0}draw(){o.save(),o.globalAlpha=1-this.radius/this.maxRadius,o.beginPath(),o.arc(this.x,this.y,this.radius,0,Math.PI*2),o.fillStyle=this.color,o.fill(),o.restore()}}function j(){o.fillStyle="black",o.fillText("Score: "+a,50,75),o.fillStyle="white",o.fillText("Score: "+a,53,78)}function tt(){if(o.textAlign="center",o.fillStyle="black",o.fillText("Game Over, your score is "+a,r.width/2,r.height/2),o.fillStyle="white",o.fillText("Game Over, your score is "+a,r.width/2+3,r.height/2+3),B.currentUser){const i=$(C,"users",B.currentUser.uid);P(i).then(e=>{e.exists()&&e.data().score<a?K(i,{score:a}).then(()=>{console.log("High score updated successfully!")}).catch(t=>{console.error("Error updating high score:",t)}):e.exists()?console.log("Current score is lower than or equal to high score. No update needed."):setDoc(i,{score:a}).then(()=>{console.log("High score set for the first time successfully!")}).catch(t=>{console.error("Error setting initial high score:",t)})}).catch(e=>{console.error("Error retrieving user document:",e)})}else console.log("No user logged in, score not saved")}function et(){resetButton.style.opacity="1",document.getElementById("resetButton").addEventListener("click",function(){location.reload()})}function it(i){const e=document.getElementById("scoresContainer");e.innerHTML="";let t=1;i.forEach(s=>{const l=document.createElement("div");l.textContent=`${t++}. ${s.username}: ${s.score}`,e.appendChild(l)})}async function st(){const i=Y(C,"users"),e=W(i,O("score","desc"),G(10));try{const s=(await X(e)).docs.map(l=>({username:l.data().username,score:l.data().score}));it(s)}catch(t){console.error("Error fetching scores:",t)}}V.addEventListener("click",function(){b.style.display="none",z.style.display="none",document.querySelector(".video-overlay").style.display="none",L(0),window.addEventListener("click",function(i){const t=m.getImageData(i.x,i.y,1,1).data;d.forEach((s,l)=>{if(s.x<i.x&&i.x<s.x+s.width&&s.y<i.y&&i.y<s.y+s.height&&t[3]>250){s.markedForDeletion=!0;let y=1;s.sizeModifier<.5&&(y=2),a+=y,c.push(new p(s.x,s.y,s.width));const n=document.createElement("div");n.classList.add("plus-one"),n.textContent=`+${y}`,n.style.left=`${i.pageX-10}px`,n.style.top=`${i.pageY-20}px`,document.body.appendChild(n),n.style.left=s.x+s.width/2+"px",n.style.top=s.y+"px",requestAnimationFrame(()=>{n.style.opacity="1",n.style.fontSize="2.5rem",n.style.transform="translateY(-30px)",setTimeout(()=>{n.remove()},600)})}})})});z.addEventListener("click",function(){location.href="/index.html"});U.addEventListener("click",function(){b.style.display="none",F.style.display="flex",st()});Q.addEventListener("click",function(){b.style.display="flex",F.style.display="none"});function L(i){h.play(),o.clearRect(0,0,r.width,r.height),m.clearRect(0,0,r.width,r.height);let e=i-I;I=i,v+=e,a!==0&&a%50===0&&a!==E&&(x=x-15,E=a,h.playbackRate+=.1),v>x&&(d.push(new Z),v=0,d.sort(function(t,s){return t.width-s.width})),j(),[...u,...d,...c].forEach(t=>{t.update(e),t.draw()}),d=d.filter(t=>!t.markedForDeletion),c=c.filter(t=>!t.markedForDeletion),u=u.filter(t=>!t.markedForDeletion),M?(h.pause(),tt(),g.play(),et()):requestAnimationFrame(L)}
